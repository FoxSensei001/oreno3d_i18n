# Oreno3dI18n 国际化功能

## 🌍 支持的语言

Oreno3dI18n 现在支持以下四种语言的用户界面：

- **Follow System** (system) - 跟随系统语言（默认选项）
- **简体中文** (zh) - 简体中文
- **繁體中文** (zh-TW) - 繁体中文（支持 TW、HK、MO 地区）
- **English** (en) - 英语
- **日本語** (ja) - 日语

## 🔧 功能特性

### 语言切换器
- 位于管理后台侧边栏的右上角
- 显示当前语言选择的国旗和名称
- 下拉菜单显示所有可用语言选项
- 当前选中的语言会有勾选标记
- **Follow System** 选项会根据浏览器语言自动选择合适的界面语言

### 智能语言检测
- **浏览器语言检测**：首次访问时自动检测浏览器的首选语言
- **支持语言匹配**：如果浏览器语言在支持列表中，自动使用该语言
- **回退机制**：如果浏览器语言不支持，默认使用英语
- **中文地区智能识别**：
  - `zh-TW`, `zh-HK`, `zh-MO` → 繁体中文
  - `zh-CN`, `zh-SG` 等其他中文变体 → 简体中文
- **语言前缀匹配**：支持语言代码前缀匹配

### 自动保存语言偏好
- **手动选择优先**：用户手动选择的语言会自动保存到 Cookie 中
- **Follow System 模式**：选择 "Follow System" 会删除 Cookie，让系统自动检测
- **持久化存储**：手动选择的语言 Cookie 有效期为 1 年
- **优先级顺序**：Cookie 设置 > 浏览器语言检测 > 默认英语

### 完整的界面翻译
- 所有用户界面文本都已翻译
- 包括导航菜单、按钮、提示信息等
- 动态内容（如模块名称）保持原始语言

## 📁 文件结构

```
messages/
├── zh.json          # 简体中文翻译
├── en.json          # 英语翻译
└── ja.json          # 日语翻译

src/
├── i18n/
│   └── request.ts   # 国际化配置
└── components/
    └── ui/
        └── language-switcher.tsx  # 语言切换组件
```

## 🎯 使用方法

### 用户操作

#### 首次访问
1. 访问管理后台 (http://localhost:3000/admin)
2. 系统会自动检测浏览器语言并显示对应界面
3. 语言切换器显示 "Follow System" 状态

#### 手动切换语言
1. 在侧边栏右上角找到语言切换器（地球图标）
2. 点击下拉菜单选择想要的语言：
   - **Follow System**: 跟随浏览器语言自动选择
   - **简体中文**: 强制使用简体中文界面
   - **繁體中文**: 强制使用繁体中文界面
   - **English**: 强制使用英语界面
   - **日本語**: 强制使用日语界面
3. 页面会自动刷新并应用新语言
4. 选择会被保存，下次访问时自动应用

### 开发者操作

#### 添加新的翻译文本
1. 在 `messages/` 目录下的对应语言文件中添加新的键值对
2. 在组件中使用 `useTranslations` hook：

```typescript
import { useTranslations } from 'next-intl';

function MyComponent() {
  const t = useTranslations('namespace');
  
  return <h1>{t('title')}</h1>;
}
```

#### 添加新语言支持
1. 在 `messages/` 目录下创建新的语言文件（如 `ko.json`）
2. 复制现有语言文件的结构并翻译内容
3. 在 `src/components/ui/language-switcher.tsx` 中添加新语言：

```typescript
const languages = [
  { code: 'zh', name: '简体中文' },
  { code: 'en', name: 'English' },
  { code: 'ja', name: '日本語' },
  { code: 'ko', name: '한국어' }, // 新增
];
```

## 📝 翻译命名空间

### common
通用文本，如按钮、操作等
```json
{
  "loading": "加载中...",
  "save": "保存",
  "cancel": "取消"
}
```

### navigation
导航菜单相关
```json
{
  "dashboard": "仪表盘",
  "modules": "模块管理",
  "settings": "设置"
}
```

### dashboard
仪表盘页面相关
```json
{
  "title": "仪表盘",
  "description": "管理和监控所有 i18n 模块的翻译进度"
}
```

### modules
模块管理页面相关
```json
{
  "title": "模块管理",
  "translationProgress": "翻译进度"
}
```

### settings
设置页面相关
```json
{
  "title": "系统设置",
  "appInfo": "应用信息"
}
```

### scraper
爬虫操作相关
```json
{
  "updating": "正在更新模块",
  "updateComplete": "更新完成！"
}
```

### language
语言切换相关
```json
{
  "switchLanguage": "切换语言",
  "chinese": "简体中文"
}
```

### errors
错误信息相关
```json
{
  "loadFailed": "加载失败",
  "networkError": "网络错误"
}
```

## 🔧 技术实现

### 核心依赖
- **next-intl**: Next.js 国际化库
- **React Context**: 提供翻译上下文

### 配置文件
```typescript
// src/i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { cookies } from 'next/headers';

export default getRequestConfig(async () => {
  const cookieStore = await cookies();
  const locale = cookieStore.get('locale')?.value || 'zh';

  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});
```

### Next.js 配置
```typescript
// next.config.ts
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts');
const nextConfig: NextConfig = {};

export default withNextIntl(nextConfig);
```

## 🎨 UI 设计

### 语言切换器样式
- 使用地球图标表示国际化功能
- 显示当前语言的国旗和名称
- 响应式设计，在小屏幕上只显示图标
- 下拉菜单使用 shadcn/ui 的 DropdownMenu 组件

### 视觉反馈
- 当前选中语言有勾选标记
- 切换时显示加载状态
- 平滑的过渡动画

## 🚀 性能优化

### 代码分割
- 翻译文件按需加载
- 只加载当前语言的翻译内容

### 缓存策略
- 语言偏好保存在 Cookie 中
- 翻译内容在构建时预加载

### 服务端渲染
- 支持 SSR，首次加载即显示正确语言
- 避免语言切换时的闪烁

## 📊 测试方法

### 手动测试
1. 访问应用并切换不同语言
2. 检查所有页面的文本是否正确翻译
3. 刷新页面确认语言偏好被保存

### API 测试
```bash
# 测试英语
curl -H "Cookie: locale=en" http://localhost:3000/admin

# 测试中文
curl -H "Cookie: locale=zh" http://localhost:3000/admin

# 测试日语
curl -H "Cookie: locale=ja" http://localhost:3000/admin
```

## 🔮 未来扩展

### 已实现功能
- [x] 自动检测浏览器语言
- [x] 智能语言回退机制
- [x] Cookie 语言偏好保存
- [x] 完整的界面翻译

### 计划中的功能
- [ ] 更多语言支持（韩语、法语等）
- [ ] RTL 语言支持
- [ ] 翻译管理界面
- [ ] 翻译进度统计
- [ ] 语言包热更新

### 贡献指南
欢迎贡献新的语言翻译！请：
1. Fork 项目
2. 添加新的语言文件
3. 更新语言切换器配置
4. 提交 Pull Request

---

**Oreno3dI18n** - 真正的国际化 i18n 管理工具！
